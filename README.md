# Учебная Виртуальная Машина (УВМ)

Ассемблер и интерпретатор для учебной виртуальной машины.

## Архитектура УВМ

### Компоненты виртуальной машины:
- **Аккумулятор** - специальный регистр для временного хранения данных
- **Память** - массив ячеек для хранения данных и программ
- **Счетчик команд** - указатель на следующую команду для выполнения

### Формат команд:
Все команды имеют размер 5 байт:
- Байт 0: биты 0-5 - код операции, биты 6-7 - старшие биты операнда
- Байты 1-4: младшие 4 байта операнда

## Язык ассемблера УВМ

Программы описываются в формате JSON как массив команд:

```json
[
  {"opcode": "LOAD_CONST", "operand": 42},
  {"opcode": "STORE_MEM", "operand": 100},
  {"opcode": "LOAD_MEM", "operand": 50},
  {"opcode": "ABS", "operand": 200}
]
```

## Поддерживаемые команды:
LOAD_CONST - Загрузка константы в аккумулятор
```json
{"opcode": "LOAD_CONST", "operand": число}
```
Загружает константу в аккумулятор

Диапазон операнда: -65536 до 131071 (17 бит со знаком)

LOAD_MEM - Чтение значения из памяти
```json
{"opcode": "LOAD_MEM", "operand": адрес}
```
Читает значение из памяти по указанному адресу в аккумулятор

Диапазон адреса: 0 до 2147483647 (31 бит)

STORE_MEM - Запись значения в память
```json
{"opcode": "STORE_MEM", "operand": адрес}
```
Записывает значение из аккумулятора в память по указанному адресу

Диапазон адреса: 0 до 2147483647 (31 бит)

ABS - Вычисление модуля
```json
{"opcode": "ABS", "operand": адрес}
```
Вычисляет модуль значения в аккумуляторе

Результат сохраняется в аккумулятор и записывается в память по указанному адресу

Диапазон адреса: 0 до 2147483647 (31 бит)

## Использование

1. Ассемблирование программы
```bash
python assembler.py <входной_файл.json> <выходной_файл.bin> [--test]
```
Пример:
```bash
python assembler.py test1.JSON program.bin --test
```
Флаг --test включает режим тестирования с выводом внутреннего представления.

2. Выполнение программы
```bash
python interpreter.py <бинарный_файл.bin>
```

Пример:
```bash
python interpreter.py program.bin
```

3. Демонстрация работы
   
```bash
python demo.py
```

# Примеры программ
## Пример 1: Базовая работа с памятью (test1.JSON)
```json
[
  {"opcode": "LOAD_CONST", "operand": 308},
  {"opcode": "STORE_MEM", "operand": 791},
  {"opcode": "LOAD_MEM", "operand": 705},
  {"opcode": "ABS", "operand": 870}
]
```

## Результат 
```bash
ДЕМОНСТРАЦИЯ АССЕМБЛЕРА И ИНТЕРПРЕТАТОРА УВМ
==================================================
Исходная программа:
[
  {
    "opcode": "LOAD_CONST",
    "operand": 42
  },
  {
    "opcode": "STORE_MEM",
    "operand": 100
  },
  {
    "opcode": "LOAD_CONST",
    "operand": 15
  },
  {
    "opcode": "ABS",
    "operand": 101
  },
  {
    "opcode": "LOAD_MEM",
    "operand": 100
  }
]

Внутреннее представление:
  0: {'opcode': 'LOAD_CONST', 'opcode_num': 58, 'operand': 42}
  1: {'opcode': 'STORE_MEM', 'opcode_num': 24, 'operand': 100}
  2: {'opcode': 'LOAD_CONST', 'opcode_num': 58, 'operand': 15}
  3: {'opcode': 'ABS', 'opcode_num': 7, 'operand': 101}
  4: {'opcode': 'LOAD_MEM', 'opcode_num': 19, 'operand': 100}

Бинарный размер: 25 байт

Выполнение программы:
Шаг 0: ACC=42, PC=1
Шаг 1: ACC=42, PC=2
Шаг 2: ACC=15, PC=3
Шаг 3: ACC=15, PC=4
Шаг 4: ACC=42, PC=5

Финальное состояние:
Аккумулятор: 42
Память[100]: 42
Память[101]: 15

==================================================
ДЕМОНСТРАЦИЯ РАБОТЫ АККУМУЛЯТОРА
==================================================
Программа:
  0: LOAD_CONST 100
  1: STORE_MEM 10
  2: LOAD_CONST 50
  3: STORE_MEM 11
  4: LOAD_MEM 10
  5: ABS 12

Пошаговое выполнение:
ШАГ | КОМАНДА           | АККУМУЛЯТОР | ПАМЯТЬ[10] | ПАМЯТЬ[11] | ПАМЯТЬ[12]
--------------------------------------------------------------------------------
  0 | LOAD_CONST      100 |         100 |          0 |          0 |          0
  1 | STORE_MEM        10 |         100 |        100 |          0 |          0
  2 | LOAD_CONST       50 |          50 |        100 |          0 |          0
  3 | STORE_MEM        11 |          50 |        100 |         50 |          0
  4 | LOAD_MEM         10 |         100 |        100 |         50 |          0
  5 | ABS              12 |         100 |        100 |         50 |        100

==================================================
ДЕМОНСТРАЦИЯ РАБОТЫ С ОТРИЦАТЕЛЬНЫМИ ЧИСЛАМИ
==================================================
Программа:
  LOAD_CONST -25
  ABS 30
  STORE_MEM 31
  LOAD_CONST -100
  ABS 32

Выполнение:
Шаг 0: LOAD_CONST -25
  Аккумулятор: -25

Шаг 1: ABS 30
  Аккумулятор: 25
  Память[30]: 25
  Память[31]: 0
  Память[32]: 0

Шаг 2: STORE_MEM 31
  Аккумулятор: 25
  Память[30]: 25
  Память[31]: 25
  Память[32]: 0

Шаг 3: LOAD_CONST -100
  Аккумулятор: -100
  Память[30]: 25
  Память[31]: 25
  Память[32]: 0

Шаг 4: ABS 32
  Аккумулятор: 100
  Память[30]: 25
  Память[31]: 25
  Память[32]: 100
```


# Автор

Нариман
